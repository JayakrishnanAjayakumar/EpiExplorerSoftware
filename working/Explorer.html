<!DOCTYPE html>
<html>
<head>
<script src="supportfiles/jquery.min.js"></script>
<!-- Bootstrap core CSS -->
<link rel="stylesheet" href="supportfiles/bootstrap.min.css">
<link href="supportfiles/dashboard.css" rel="stylesheet">
<link href="supportfiles/jquery-ui.min.css" rel="stylesheet">
<link href="supportfiles/jquery-ui.structure.min.css" rel="stylesheet">
<link href="supportfiles/jquery-ui.theme.min.css" rel="stylesheet">
<!-- custom style for SEDE -->
<link href="supportfiles/sede.css" rel="stylesheet">
<script src="supportfiles/bootstrap.min.js"></script>
<script
	src="http://maps.google.com/maps/api/js?key=AIzaSyBis1Boyn_1lnN34CojAkzm2k50UJ7UBA0&libraries=visualization,drawing">
</script>
<script charset="utf-8" src="supportfiles/d3.min.js"
	type="text/javascript"></script>
<script charset="utf-8" src="supportfiles/map_style.js"
	type="text/javascript"></script>
<script charset="utf-8" src="supportfiles/jquery-ui.min.js"
	type="text/javascript"></script>
<script charset="utf-8" src="supportfiles/d3-tip.min.js"
	type="text/javascript"></script>
<script charset="utf-8" src="supportfiles/moment.js"
	type="text/javascript"></script>
<script src="supportfiles/d3.layout.cloud.js"></script>
<script src="supportfiles/html2canvas.min.js"></script>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<script>
   var spatialPoints=d3.map();
   var currsid,currdate,currcategory,currneighborhood,drawingManager,kmlData=[],datesliders,spatialObject;
   var f=d3.format(".0%");
   var f2=d3.format(",");
   var color = ["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854"];
   var currentdef='Default',gmap,gmap2,gmap3,markerindex,neighborhoodmap=d3.map(),neighborhoodenvmap=d3.map(),pathpolyline=new google.maps.Polyline({strokeColor:"blue",strokeOpacity: 0.5,strokeWeight: 1.5}),player,layer,overlay,svgbounds={},projection,datajson,padding=10,slider,timer,checkoffset=false,gpsloaded=false,gpslocked=false,videoid,drawingManager,currmarkerarray=[],currind=0,searchedindexes;
   var infowindow = new google.maps.InfoWindow({
          content: '',
		  maxWidth: 300
   });
   var hmaplayer=new google.maps.visualization.HeatmapLayer({radius:30});
    //function to load google maps
	function initialize(){
		gmap = new google.maps.Map(d3.select("#map").node(), {
			zoom : 16,
			center : new google.maps.LatLng(41.15, -81.36),
			mapTypeId : google.maps.MapTypeId.ROADMAP
		});
		gmap2 = new google.maps.Map(d3.select("#map2").node(), {
			zoom : 22,
			styles:mapstyle,
			zoomControl: true,
			mapTypeControl: false,
			fullscreenControl: false,
			streetViewControl: false,
			center : new google.maps.LatLng(41.15, -81.36),
			mapTypeId : google.maps.MapTypeId.ROADMAP
		});
		gmap3 = new google.maps.Map(d3.select("#map3").node(), {
			zoom : 22,
			styles:mapstyle,
			zoomControl: true,
			mapTypeControl: false,
			fullscreenControl: false,
			streetViewControl: false,
			center : new google.maps.LatLng(41.15, -81.36),
			mapTypeId : google.maps.MapTypeId.ROADMAP
		});
		$( "#date_text" ).datepicker({
			dateFormat:"yy-mm-dd"
		});
		$( "#date_env_text" ).datepicker({
			dateFormat:"yy-mm-dd"
		});
		$( "#download_date" ).datepicker({
			dateFormat:"yy-mm-dd"
		});
		var alldata=JSON.parse(exp.loadAllSamplePointInstances());
		var bounds=new google.maps.LatLngBounds();
		for (i=0;i<alldata.length;i++){
			spoints=JSON.parse(alldata[i]);
			bounds.extend(new google.maps.LatLng(spoints.position.split(',')[1], spoints.position.split(',')[0]));
			addSamplePointToMap(spoints.code,spoints.position.split(','));
			setCategoryForMarker(spoints.code,spoints.category);
			d3.select('#samplepoints').append('option').property('value',spoints.code).text(spoints.code);
			d3.select('#add_spoints').append('option').property('value',spoints.code).text(spoints.code);
			d3.select('#update_spoints').append('option').property('value',spoints.code).text(spoints.code);
		}
		gmap.fitBounds(bounds);
		gmap2.fitBounds(bounds);
		gmap3.fitBounds(bounds);
		drawingManager = new google.maps.drawing.DrawingManager({
			drawingMode : null,
			drawingControl : true,
			drawingControlOptions : {
				position : google.maps.ControlPosition.TOP_CENTER,
				drawingModes : [ 'marker']
			}
		});
		drawingManager.setMap(gmap);
		google.maps.event.addListener(drawingManager, 'overlaycomplete',
			function(event) {
				var overlaydat = event.overlay;
				if(event.type=='marker'){
					$('#create_point_lat_text').val(overlaydat.getPosition().lat());
					$('#create_point_lon_text').val(overlaydat.getPosition().lng());
					createSamplePoint();
					overlaydat.setMap(null);
				}
			}
		);
		//testing a service for sim matrix
		var reqObj={};
		reqObj.monthyear='2017-09';
		reqObj.categories=['mud<>env','coliform<>exp'];
		reqObj.geometry={type:'point',coordinates:[-72.349797521,18.5379209820001]};
		//exp.getSimilarityMatrices(JSON.stringify(reqObj));
		//set extent for the slider
		datesliders=JSON.parse(exp.getAllMonthYear());
		$('#timeslider').attr('min', 0);
		$('#timeslider').attr('max', datesliders.length-1);
		$('#timeslider').val(0);
		$('#yearmonth').val(datesliders[0]);
		$('#hmaptimeslider').attr('min', 0);
		$('#hmaptimeslider').attr('max', datesliders.length-1);
		$('#hmaptimeslider').val(0);
		$('#hmapyearmonth').val(datesliders[0]);
		var categories=JSON.parse(exp.getAllCategories());
		var neighborhoods=JSON.parse(exp.getAllNeighborhoods());
		var neighbs=['All'].concat(neighborhoods);
		d3.select('#hmapcategories').selectAll('option').data(categories).enter().append('option').property('value',function(d){return d;}).text(function(d){return d;});
		d3.select('#hmapneighborhoods').selectAll('option').data(neighbs).enter().append('option').property('value',function(d){return d;}).text(function(d){return d;});
	}
   //change modal category text on category drop down change
   function updateCategCreateText(categ){
		var categsel=categ.value;
		if (categsel=='default')
			$('#create_point_categ_text').val('');
		else
			$('#create_point_categ_text').val(categsel);
   }
   //load sample point modal for creation
   function createSamplePoint(){
	   $("#edit_modal").modal('hide');
		$("#new_samp_button").prop("disabled",false);
		$("#update_samp_button").prop("disabled",true);
		$("#delete_samp_button").prop("disabled",true);
		$("#create_point_id_text").prop("disabled", false);
		clearSamplePointModal();
		$("#samplepointmodal").modal();
   }
   //generate samplepoint from modal data
   function generateSamplePointFromModal(){
		var samplepoint={};
		samplepoint.code=$('#create_point_id_text').val();
		samplepoint.type_=$('#create_point_type_text').val();
		samplepoint.address=$('#create_point_address_text').val();
		samplepoint.position=$('#create_point_lon_text').val()+","+$('#create_point_lat_text').val();
		samplepoint.category=$('#create_point_categ_text').val();
		samplepoint.neighborhood=$('#create_point_neighborhood_text').val();
		samplepoint.reservoircapacity=$('#create_point_reservoir_capacity_text').val();
		samplepoint.resrvoirwithtap=$('#create_point_reservoir_tap_text').val();
		samplepoint.covered=$('#create_point_covered_text').val();
		samplepoint.waterusedfordrinking=$('#create_point_water_drinking_text').val();
		samplepoint.waterusedforbathwash=$('#create_point_water_bath_text').val();
		samplepoint.image=$('#sampimg_text').val();
		return samplepoint;
   }
   //generate record from modal
   function generateRecordFromModal(){
		var record={};
		record.do=$('#do_text').val();
		record.temp=$('#temp_text').val();
		record.cond=$('#cond_text').val();
		record.tds=$('#tds_text').val();
		record.salinity=$('#salinity_text').val();
		record.ph=$('#ph_text').val();
		record.coliform=$('#coliform_text').val();
		record.cholerae=$('#cholerae_text').val();
		record.residualchlorine=$('#residualchlorine_text').val();
		record.date=$('#date_text').val();
		return record;
   }
   //generate environment record from modal
   function generateRecordEnvFromModal(){
	    var record={};
		record.water=$('#water_text').val();
		record.mud=$('#mud_text').val();
		record.trash=$('#trash_text').val();
		record.activity=$('#activity_text').val();
		record.date=$('#date_env_text').val();
		record.image=$('#img_text').val();
		return record;
   }
   //function to validate a sample point. The ids shouldn't be empty and lat/lon should be valid, will return a message if not valid or return null
   function validateSamplePoint(samplepoint){
		if (samplepoint.code.length == 0) 
			return "Id field cannot be empty";
		var coords=samplepoint.position.split(',');
		if(coords[0].length==0||coords[1].length==0)
			return "Lat/Lon field cannot be empty";
		//validate lat lon's check if they are floats and with in bounds of lat lon
		var lon=parseFloat(coords[0]);
		var lat=parseFloat(coords[1]);
		if (isNaN(lon)||isNaN(lat))
			return "Lat/Lon field can only have real number values";
		if (lon>180||lon<-180||lat>90||lat<-90)
			return "Longitude should be between -180 and +180 degrees and latitude should be between -90 and +90 degrees";
		return null;
   }
   //create a new sample point, if it doesnot exist
   function createNewSamplePoint(){
		var samplepoint=generateSamplePointFromModal();
		var check=validateSamplePoint(samplepoint);
		if (check) {
			alert(check);
			return false;
		}
		if (exp.checkIdExists(samplepoint.code)=='Y'){
			alert("Id exists you might want to use update sample point feature");
			return false;
		}
		alert(exp.createNewSamplePoint(samplepoint));
		d3.select('#samplepoints').append('option').property('value',samplepoint.code).text(samplepoint.code);
		$('#samplepointmodal').modal('hide');
        //add the new sample point to both record dropdowns
        d3.select('#add_spoints').append('option').property('value',samplepoint.code).text(samplepoint.code);
        d3.select('#update_spoints').append('option').property('value',samplepoint.code).text(samplepoint.code);
		addSamplePointToMap(samplepoint.code,samplepoint.position.split(','));
		setCategoryForMarker(samplepoint.code,samplepoint.category);
		//map center to the newly added point
		gmap.setCenter(new google.maps.LatLng(samplepoint.position.split(',')[1], samplepoint.position.split(',')[0]));
		animateMarker(samplepoint.code);
   }
   
   function animateMarker(samplepointId){
		var marker=spatialPoints.get(samplepointId);
		marker.setAnimation(google.maps.Animation.BOUNCE);
		setTimeout(function(){ marker.setAnimation(null); }, 2000);
   }
   //load sample point modal for updation
   function updateSamplePoint(){
		if( $('#samplepoints').has('option').length == 0 ) {
			alert("Atleast one Point Id should be selected for updation");
			return false;
		}
		$("#edit_modal").modal('hide');
		//get the sample point from dataset
		var samplepoint=JSON.parse(exp.getSamplePointInfoForId($('#samplepoints').find(":selected").text()));
		//add data to modal
		$('#create_point_id_text').val(samplepoint.code);
		$('#create_point_type_text').val(samplepoint.type_);
		$('#create_point_address_text').val(samplepoint.address);
		$('#create_point_lat_text').val(samplepoint.position.split(',')[1]);
		$('#create_point_lon_text').val(samplepoint.position.split(',')[0]);
		$('#create_point_categ_text').val(samplepoint.category);
		$('#create_point_neighborhood_text').val(samplepoint.neighborhood);
		$('#create_point_reservoir_capacity_text').val(samplepoint.reservoircapacity);
		$('#create_point_reservoir_tap_text').val(samplepoint.resrvoirwithtap);
		$('#create_point_covered_text').val(samplepoint.covered);
		$('#create_point_water_drinking_text').val(samplepoint.waterusedfordrinking);
		$('#create_point_water_bath_text').val(samplepoint.waterusedforbathwash);
		$('#sampimg_text').val(samplepoint.image);
		$("#update_samp_button").prop("disabled",false);
		$("#delete_samp_button").prop("disabled",false);
		$("#new_samp_button").prop("disabled",true);
		//disable the id
		$("#create_point_id_text").prop("disabled", true);
		$("#samplepointmodal").modal();
   }
   //function to update a sample point
   function updateExistingSamplePoint(){
		var samplepoint=generateSamplePointFromModal();
		var check=validateSamplePoint(samplepoint);
		if (check) {
			alert(check);
			return false;
		}
		alert(exp.updateExistingSamplePoint(samplepoint));
		$('#samplepointmodal').modal('hide');
		updateSamplePointInMap(samplepoint.code,samplepoint.position.split(','));
		setCategoryForMarker(samplepoint.code,samplepoint.category);
		//map center to updated point
		gmap.setCenter(new google.maps.LatLng(samplepoint.position.split(',')[1], samplepoint.position.split(',')[0]));
		animateMarker(samplepoint.code);
   }
   //function to delete a sample point
   function deleteExistingSamplePoint(){
		var samplepointId=$('#create_point_id_text').val();
		alert(exp.deleteExistingSamplePoint(samplepointId));
		$('#samplepointmodal').modal('hide');
		$('#samplepoints option:selected').remove();
        //should also remove the sample point id's from the record dropdowns
        $("#add_spoints option[value='"+samplepointId+"']").remove();
        $("#update_spoints option[value='"+samplepointId+"']").remove();
		removeSamplePointFromMap(samplepointId);
   }
   function getMarkerURLForCategory(category){
		if(category=='Pipe/Cistern')
			return 'http://maps.google.com/mapfiles/kml/pushpin/ylw-pushpin.png';
		if(category=='Ocean')
			return 'http://maps.google.com/mapfiles/kml/pushpin/blue-pushpin.png';
		if(category=='Drainage')
			return 'http://maps.google.com/mapfiles/kml/pushpin/grn-pushpin.png';
		if(category=='Combined')
			return 'http://maps.google.com/mapfiles/kml/pushpin/wht-pushpin.png';
		else
			return 'http://maps.google.com/mapfiles/kml/paddle/ylw-stars.png';
   }
   function setCategoryForMarker(samplepointId,category){
		var spoint=spatialPoints.get(samplepointId);
		spoint.setIcon({scaledSize : new google.maps.Size(30, 30),url : getMarkerURLForCategory(category)});
   }
   //add a sample point as marker to map
   function addSamplePointToMap(samplepointId,coords){
		var spoint = new google.maps.Marker({
			position: new google.maps.LatLng(coords[1], coords[0]),
			map: gmap,
			draggable:false,
			icon: {
				scaledSize : new google.maps.Size(30, 30),
				url : 'http://maps.google.com/mapfiles/kml/pushpin/ylw-pushpin.png'
			}
		});

		google.maps.event.addListener(spoint,  'rightclick',  function(mouseEvent) {
			$("#samplepoints").val(samplepointId);
			updateSamplePoint();
		});
		spoint.set("id",samplepointId);
		spoint.addListener('mouseover', function() {
		    infowindow.open(gmap, this);
		    var data=JSON.parse(exp.getSamplePointInfoForId(this.get("id")));
		    var imageForData=exp.getImageForData(this.get("id"));
		    var imgstring='<img src="" alt="Image" height="50%" width="50%">';
			if(imageForData.length!=0){
				imgstring='<img src="'+"../data/recordimages/"+imageForData+'" alt="Image" height="50%" width="50%">';
			}
		    var divstring='<div><span>Name:'+data.code+'</span><br><span>Type:'+data.type_+'</span><br><span>Category:'+data.category+'</span><br><span>Neighborhood:'+data.neighborhood+'</span><br>'+imgstring+'</div>';
            infowindow.setContent(divstring);
		});
		spoint.addListener('mouseout', function() {
		    infowindow.close();
		});
		spoint.addListener('click', function() {
		    $('#spoint_id').val(this.get("id"));
		    d3.select('#dateselect').selectAll('option').remove();
		    var dates=JSON.parse(exp.getRecordDatesForSamplePoints(this.get("id")));
		    d3.select('#dateselect').selectAll('option').data(dates).enter().append('option').property('value',function(d){return d;}).text(function(d){return d;});
		    $("#datemodal").modal();
		});
		spatialPoints.set(samplepointId,spoint);
   }
   //remove a spatial point from the map
   function removeSamplePointFromMap(samplepointId){
		var spoint=spatialPoints.get(samplepointId);
		spoint.setMap(null);
		spatialPoints.remove(samplepointId);
   }
   //update spatial point position in map
   function updateSamplePointInMap(samplepointId,coords){
		var spoint=spatialPoints.get(samplepointId);
		spoint.setPosition(new google.maps.LatLng(coords[1], coords[0]));
   }
   
   function openExperimentalRecord(){
	 	$('#record_add_prompt_modal').modal('hide');
	  	clearRecordModal();
		$("#new_rec_button").prop("disabled",false);
		$("#update_rec_button").prop("disabled",true);
		$("#delete_rec_button").prop("disabled",true);
		$("#recordsmodal").modal();
   }
   
   function openEnvironmentalRecord(){
	   $('#record_add_prompt_modal').modal('hide');
	    clearEnvironmentalModal();
		$("#new_env_rec_button").prop("disabled",false);
		$("#update_env_rec_button").prop("disabled",true);
		$("#delete_env_rec_button").prop("disabled",true);
		$("#envrecordsmodal").modal();
   }
   //load record modal for creating new record
   function addRecord(){
	   $("#edit_modal").modal('hide');
	   $("#record_add_prompt_modal").modal();
   }
   //create new record from the record modal
   function createNewRecord(){
		var record=generateRecordFromModal();
		//check if the record already exists. If it exists, then an update should be performed.
		if (exp.checkRecordExists($('#add_spoints').find(":selected").text(),record.date)=='Y'){
			alert('This record already exist, perform an update to make changes');
			return false;
		}
		//back end for complex validation
		var check=exp.validateRecord(record);
		if (check.length!=0){
			alert(check);
			return false;
		}
		//add the record
		record.scode=$('#add_spoints').find(":selected").text();
		alert(exp.createNewRecord(record));
		$('#recordsmodal').modal('hide');
   }
   //create new record from the record modal
   function createNewEnvRecord(){
		var record=generateRecordEnvFromModal();
		//check if the record already exists. If it exists, then an update should be performed.
		if (exp.checkEnvRecordExists($('#add_spoints').find(":selected").text(),record.date)=='Y'){
			alert('This record already exist, perform an update to make changes');
			return false;
		}
		//back end for complex validation
		var check=exp.validateEnvRecord(record);
		if (check.length!=0){
			alert(check);
			return false;
		}
		//add the record
		record.scode=$('#add_spoints').find(":selected").text();
		alert(exp.createNewEnvRecord(record));
		$('#envrecordsmodal').modal('hide');
   }
   
   function updateExperimentalRecord(){
	   $("#record_update_prompt_modal").modal('hide');
	   if ($('#dateselectexpupdate').has('option').length == 0){
		   alert('Date field empty');
		   return false;
	   }
	    //get the sample point from dataset
		var record=JSON.parse(exp.getRecord($('#update_spoints').find(":selected").text(),$('#dateselectexpupdate').find(":selected").text()));
		//populate the modal with data from record
		$('#do_text').val(record.do);
		$('#temp_text').val(record.temp);
		$('#cond_text').val(record.cond);
		$('#tds_text').val(record.tds);
		$('#salinity_text').val(record.salinity);
		$('#ph_text').val(record.ph);
		$('#coliform_text').val(record.coliform);
		$('#cholerae_text').val(record.cholerae);
		$('#residualchlorine_text').val(record.residualchlorine);
		$('#date_text').val(record.date);
		//enable/disable buttons
		$("#new_rec_button").prop("disabled",true);
		$("#update_rec_button").prop("disabled",false);
		$("#delete_rec_button").prop("disabled",false);
		$("#date_text").prop("disabled",true);
		$("#recordsmodal").modal();
   }
   
   function updateEnvironmentalRecord(){
	   $("#record_update_prompt_modal").modal('hide');
	   if ($('#dateselectenvupdate').has('option').length == 0){
		   alert('Date field empty');
		   return false;
	   }
	    //get the sample point from dataset
		var record=JSON.parse(exp.getEnvRecord($('#update_spoints').find(":selected").text(),$('#dateselectenvupdate').find(":selected").text()));
		//populate the modal with data from record
		$('#water_text').val(record.water);
		record.mud=$('#mud_text').val(record.mud);
		$('#trash_text').val(record.trash);
		$('#activity_text').val(record.activity);
		$('#date_env_text').val(record.date);
		$('#img_text').val(record.image);
		$("#new_env_rec_button").prop("disabled",true);
		$("#update_env_rec_button").prop("disabled",false);
		$("#delete_env_rec_button").prop("disabled",false);
		$("#date_env_text").prop("disabled",true);
		$("#envrecordsmodal").modal();
   }
   
   //load record modal for updating existing record
   function updateRecord(){
	   var selected=$('#update_spoints').find(":selected").text();
	   d3.select('#dateselectexpupdate').selectAll('option').remove();
	   d3.select('#dateselectenvupdate').selectAll('option').remove();
	   var expDates=JSON.parse(exp.getRecordDatesForSamplePoints(selected));
	   var envDates=JSON.parse(exp.getEnvRecordDatesForSamplePoints(selected));
	   d3.select('#dateselectexpupdate').selectAll('option').data(expDates).enter().append('option').property('value',function(d){return d;}).text(function(d){return d;});
	   d3.select('#dateselectenvupdate').selectAll('option').data(envDates).enter().append('option').property('value',function(d){return d;}).text(function(d){return d;});
	   $("#edit_modal").modal('hide');
	   $("#record_update_prompt_modal").modal();
   }
   //function to update the record details
   function updateExistingRecord(){
		var record=generateRecordFromModal();
		//back end for complex validation
		var check=exp.validateRecord(record);
		if (check.length!=0){
			alert(check);
			return false;
		}
		record.scode=$('#update_spoints').find(":selected").text();
		//update the record
		alert(exp.updateExistingRecord(record));
		$('#recordsmodal').modal('hide');
   }
   
   function updateExistingEnvRecord(){
		var record=generateRecordEnvFromModal();
		//back end for complex validation
	    var check=exp.validateEnvRecord(record);
	    if (check.length!=0){
			alert(check);
			return false;
		}
	    record.scode=$('#update_spoints').find(":selected").text();
	  //update the record
		alert(exp.updateExistingEnvRecord(record));
		$('#envrecordsmodal').modal('hide');
   }
   //function to delete an existing record
   function deleteExistingRecord(){
		var record=generateRecordFromModal();
		//check if the record already exists. If it doesn't we can't perform deletion
		if (exp.checkRecordExists($('#update_spoints').find(":selected").text(),record.date)!='Y'){
			alert('This record doesnot exist and cannot be deleted');
			return false;
		}
        alert(exp.deleteExistingRecord($('#update_spoints').find(":selected").text(),record.date));
        $('#recordsmodal').modal('hide');
   }
   //function to delete an existing record
   function deleteExistingEnvRecord(){
		var record=generateRecordEnvFromModal();
		//check if the record already exists. If it doesn't we can't perform deletion
		if (exp.checkEnvRecordExists($('#update_spoints').find(":selected").text(),record.date)!='Y'){
			alert('This record doesnot exist and cannot be deleted');
			return false;
		}
        alert(exp.deleteExistingEnvRecord($('#update_spoints').find(":selected").text(),record.date));
        $('#envrecordsmodal').modal('hide');
   }
   //function to clear samplepoint modal
   function clearSamplePointModal(){
		$('#create_point_id_text').val('');
		$('#create_point_type_text').val('');
		$('#create_point_address_text').val('');
		//$('#create_point_lat_text').val('');
		//$('#create_point_lon_text').val('');
		$('#create_point_categ_text').val('default');
		$("#create_point_categ_select").val('default');
		$("#create_point_neighborhood_text").val('');
		$("#create_point_reservoir_capacity_text").val('');
		$("#create_point_reservoir_tap_text").val('');
		$("#create_point_covered_text").val('');
		$("#create_point_water_drinking_text").val('');
		$("#create_point_water_bath_text").val('');
		$('#sampimg_text').val('');
   }
   //function to clear record modal
   function clearEnvironmentalModal(){
		$('#trash_text').val('');
		$('#activity_text').val('');
		$('#mud_text').val('');
		$('#water_text').val('');
		$('#date_env_text').val(moment().format('YYYY-MM-DD') );
		$("#date_env_text").prop("disabled",false);
		$('#img_text').val('');
   }
   //function to clear record modal
   function clearRecordModal(){
		$('#do_text').val('');
		$('#temp_text').val('');
		$('#cond_text').val('');
		$('#tds_text').val('');
		$('#salinity_text').val('');
		$('#ph_text').val('');
		$('#coliform_text').val('');
		$('#cholerae_text').val('');
		$('#residualchlorine_text').val('');
		$('#date_text').val(moment().format('YYYY-MM-DD') );
		$("#date_text").prop("disabled",false);
   }
   //function to upload records from file
   function uploadRecords(){
		var upload=exp.uploadRecordFile();
		if (upload.length==0){
			return;
		}
		var dat=JSON.parse(upload);
		if(dat.hasOwnProperty('Error')){
			alert(dat.Error);
			return;
		}
		else{
			$('#fname').val(dat.filename);
			var bounds=new google.maps.LatLngBounds();
			for (i=0;i<dat.samplepoints.length;i++){
				bounds.extend(new google.maps.LatLng(dat.samplepoints[i][1][1], dat.samplepoints[i][1][0]));
				addSamplePointToMap(dat.samplepoints[i][0],dat.samplepoints[i][1]);
				setCategoryForMarker(dat.samplepoints[i][0],dat.samplepoints[i][2]);
				d3.select('#samplepoints').append('option').property('value',dat.samplepoints[i][0]).text(dat.samplepoints[i][0]);
				d3.select('#add_spoints').append('option').property('value',dat.samplepoints[i][0]).text(dat.samplepoints[i][0]);
				d3.select('#update_spoints').append('option').property('value',dat.samplepoints[i][0]).text(dat.samplepoints[i][0]);
			}
			gmap.fitBounds(bounds);
		}
   }

   //open the visualization parameter options
   function openVizParameters(){
	   d3.select('#vizpointselect').selectAll('option').remove();
	   d3.select('#vizdateselect').selectAll('option').remove();
	   d3.select('#vizneighborhoodselect').selectAll('option').remove();
	   d3.select('#vizneighborhoodcategselect').selectAll('option').remove();
	   var categs=JSON.parse(exp.getAllCategories());
	   d3.select('#vizcategselect').selectAll('option').remove();
	   d3.select('#vizcategselect').selectAll('option').data(categs).enter().append('option').property('value',function(d){return d;}).text(function(d){return d;});
	   popSamplePointForCategories();
	   popNeighborhoods();
	   $("#vizmodal").modal();
	   document.getElementById("defaultOpen").click();
   }
   
   function popNeighborhoods(){
	   var neighborhoods=JSON.parse(exp.getAllNeighborhoods());
	   d3.select('#vizneighborhoodselect').selectAll('option').data(neighborhoods).enter().append('option').property('value',function(d){return d;}).text(function(d){return d;});
	   popCategsForNeighborhood();
   }
   
   function popCategsForNeighborhood(){
	   d3.select('#vizneighborhoodcategselect').selectAll('option').remove();
	   var selectedNeighborhood=$('#vizneighborhoodselect').find(":selected").text();
	   var categs=JSON.parse(exp.getAllCategsForNeighborhood(selectedNeighborhood));
	   d3.select('#vizneighborhoodcategselect').selectAll('option').data(categs).enter().append('option').property('value',function(d){return d;}).text(function(d){return d;});
	   popSamplePointForNeighborhoodCategory();
   }
   
   function popSamplePointForNeighborhoodCategory(){
	   d3.select('#vizneighborhoodsamplepointselect').selectAll('option').remove();
	   var selectedNeighborhood=$('#vizneighborhoodselect').find(":selected").text();
	   var selectedCateg=$('#vizneighborhoodcategselect').find(":selected").text();
	   var samplePoints=JSON.parse(exp.getSamplePointsForNeighborhoodCategory(selectedNeighborhood,selectedCateg));
	   d3.select('#vizneighborhoodsamplepointselect').selectAll('option').data(samplePoints).enter().append('option').property('value',function(d){return d;}).text(function(d){return d;});
	   popSamplePointDateForNeighborhoodCategory();
   }
   
   function popSamplePointDateForNeighborhoodCategory(){
	   d3.select('#vizneighborhoodsamplepointdateselect').selectAll('option').remove();
	   var selectedSamplePoint=$('#vizneighborhoodsamplepointselect').find(":selected").text();
	   var dates=JSON.parse(exp.getRecordDatesForSamplePoints(selectedSamplePoint));
	   d3.select('#vizneighborhoodsamplepointdateselect').selectAll('option').data(dates).enter().append('option').property('value',function(d){return d;}).text(function(d){return d;});
   }
   
   function popDateForViz(){
	   d3.select('#vizdateselect').selectAll('option').remove();
	   var selected=$('#vizpointselect').find(":selected").text();
       var dates=JSON.parse(exp.getRecordDatesForSamplePoints(selected));
       d3.select('#vizdateselect').selectAll('option').data(dates).enter().append('option').property('value',function(d){return d;}).text(function(d){return d;});
   }
   
   function popSamplePointForCategories(){
	   var selectedcateg=$('#vizcategselect').find(":selected").text();
	   d3.select('#vizpointselect').selectAll('option').remove();
	   d3.select('#vizdateselect').selectAll('option').remove();
	   var spoints=JSON.parse(exp.getAllSamplePointsForCategory(selectedcateg));
	   d3.select('#vizpointselect').selectAll('option').data(spoints).enter().append('option').property('value',function(d){return d;}).text(function(d){return d;});
	   popDateForViz();
   }
   
   function normalizeCircles(){
	   var keys=neighborhoodmap.keys();
	   var dat=[];
	   var pos=null;
	   for (var i=0;i<keys.length;i++){
		   var circ=neighborhoodmap.get(keys[i]);
		   if(circ.get('isNeighb')){
			   var val=circ.get('colcount');
			   if(!circ.get('selected'))
			   	   circ.setOptions({strokeColor:'#008000',fillColor:'#008000',strokeOpacity:.5,fillOpacity:.5});
			   if (val!=0){
				   val=Math.log(val)/Math.log(10);
			   }
			   dat.push([keys[i],val]);
			   pos=circ.getCenter();
		   }
	   }
	   dat.sort(function(a,b){return b[1]-a[1]});
	   var scale= d3.scale.linear().domain([0,1]).range([3,15]);
	   for(j=0;j<dat.length;j++){
		   neighborhoodmap.get(dat[j][0]).setRadius(scale(dat[j][1]/dat[0][1]));
		   neighborhoodmap.get(dat[j][0]).set('rank',j+1);
	   }
   }
   
   function normalizeEnvCircles(){
	   var keys=neighborhoodenvmap.keys();
	   var dat=[];
	   var pos=null;
	   for (var i=0;i<keys.length;i++){
		   var circ=neighborhoodenvmap.get(keys[i]);
		   if(circ.get('isNeighb')){
			   var val=circ.get('value');
			   if(!circ.get('selected'))
			   	   circ.setOptions({strokeColor:'#008000',fillColor:'#008000',strokeOpacity:.5,fillOpacity:.5});
			   dat.push([keys[i],val]);
			   pos=circ.getCenter();
		   }
	   }
	   dat.sort(function(a,b){return b[1]-a[1]});
	   var scale= d3.scale.linear().domain([0,1]).range([3,15]);
	   for(j=0;j<dat.length;j++){
		   neighborhoodenvmap.get(dat[j][0]).setRadius(scale(dat[j][1]/dat[0][1]));
		   neighborhoodenvmap.get(dat[j][0]).set('rank',j+1);
	   }
   }
   
   function clearAllCircles(){
	   var circles=neighborhoodmap.values();
	   for (i=0;i<circles.length;i++){
		   circles[i].setMap(null);
	   }
	   neighborhoodmap=d3.map();
   }
   
   function clearEnvCircles(){
	   var circles=neighborhoodenvmap.values();
	   for (i=0;i<circles.length;i++){
		   circles[i].setMap(null);
	   }
	   neighborhoodenvmap=d3.map();
   }
   
   //visualize categorydatainmap
   function visualizeNeighborhoodDataInMap(alldata){
	   var allCategdata=alldata.categdata;
	   var allCategSameNeighbIds=alldata.neighborhooddata;
	   clearAllCircles();
	   var pos=null;
	   for (var i=0;i<allCategdata.length;i++){
		   //var coords=JSON.parse(exp.getCoordinatesForId(allCategdata[i][0]));
		   var color='#000000';
		   var strokeOp=1;
		   var fillOp=1;
		   if(allCategdata[i][0]==alldata.sid||allCategSameNeighbIds.indexOf(allCategdata[i][0])!=-1){
			   strokeOp=.5;
			   fillOp=.5;
			   if (allCategdata[i][0]==alldata.sid)
				   color='#FF0000';
		   }
		   var sampCircle = new google.maps.Circle({
	            strokeColor: color,
	            strokeOpacity: strokeOp,
	            strokeWeight: 2,
	            fillColor: color,
	            fillOpacity: fillOp,
	            map: gmap2,
	            center: spatialPoints.get(allCategdata[i][0]).getPosition(),
	            radius: 2
	       });
		   sampCircle.set("sid",allCategdata[i][0]);
		   sampCircle.set("colcount",allCategdata[i][2]);
		   sampCircle.set("date",allCategdata[i][3]);
		   sampCircle.set("coldec",allCategdata[i][1]);
		   sampCircle.set("isNeighb",false);
		   sampCircle.set('selected',false);
		   sampCircle.set('category',alldata.category);
		   sampCircle.set('rank',0);
		   if (allCategdata[i][0]==alldata.sid){
			   pos=spatialPoints.get(allCategdata[i][0]).getPosition();
			   sampCircle.set('selected',true);
		   }
		   if (allCategSameNeighbIds.indexOf(allCategdata[i][0])!=-1)
			   sampCircle.set("isNeighb",true);
		   google.maps.event.addListener(sampCircle,'rightclick',  function(mouseEvent){
			    gmap.setZoom(17);
		        gmap.panTo(spatialPoints.get(this.get('sid')).getPosition());
		        animateMarker(this.get('sid'));
		   });
		   google.maps.event.addListener(sampCircle,'click',  function(mouseEvent){
			    if(!this.get('isNeighb')){
			    	this.set('isNeighb',true);
			    	normalizeCircles();
			    	//do the same for environmental circles
			    	neighborhoodenvmap.get(this.get("sid")).set('isNeighb',true);
			    	normalizeEnvCircles();
			    }
			    else{
			    	var vizparameters={};
			    	vizparameters.code=this.get("sid");
			    	vizparameters.date=this.get("date");
			    	vizparameters.category=this.get("category");
			    	visualizeDataFromParameters(vizparameters);
			    }
		   });
		   
		   sampCircle.addListener('mouseover', function() {
			   if(this.get('isNeighb')){
			       var divstring='<div><span>Code:'+this.get("sid")+'</span><br><span>Coliformcount:'+this.get('colcount')+'</span><br><span>Category:'+this.get('category')+'</span><br><span>Date:'+this.get('date')+'</span><br><span>Rank:'+this.get('rank')+'</span></div>';
			       infowindow.setContent(divstring);
			       infowindow.setPosition(this.getCenter());
				   infowindow.open(gmap2);
			   } 
		   });
		   sampCircle.addListener('mouseout', function() {
			    infowindow.close();
		   });
		   neighborhoodmap.set(allCategdata[i][0],sampCircle);
	   }
	   gmap2.setZoom(18);
  	   gmap2.panTo(pos);
	   normalizeCircles();
   }
   
   //visualize category data
   function visualizeCategData(alldata){
	    var categdata=alldata.categdata;
	    var category=alldata.category;
	    var samplepointId=alldata.sid;
	    var neighborhood=alldata.neighborhood;
	    var date=alldata.date;
	    d3.select('#svgdiv1').selectAll("svg").remove();
   		var divwidth=parseInt(d3.select("#svgdiv1").style("width"), 10);
		var divheight=parseInt(d3.select("#svgdiv1").style("height"), 10);
		var margin={};
		margin.left=.2*divwidth;
		margin.right=.1*divwidth;
		margin.top=.1*divheight;
		margin.bottom=.2*divheight;
		var width=divwidth-margin.left-margin.right
		var height=divheight-margin.top-margin.bottom;
		var x = d3.scale.ordinal().rangeRoundBands([0, width], .1);
		var y = d3.scale.linear().range([height, 0]);
		// Define the line
	   	var valueline = d3.svg.line()
	       .x(function(d) { return x(d[0]); })
	       .y(function(d) { return y(d[1]); });
		var catnames=[];
		categdata.forEach(function(d){
			catnames.push(d[0]);
		});
		x.domain(catnames);
		y.domain([0, 1]);
		var yAxis = d3.svg.axis().scale(y).orient("left").ticks(5).tickFormat(f);
		var xAxis = d3.svg.axis().scale(x).orient("bottom").tickValues([]);
		var tip = d3.tip().attr('class', 'd3-tip').offset([-10, 0]).html(function(d,i) {
			return "<strong>Code:</strong> <span style='color:red'>" + d[0] + "</span><br><strong>Coliform Percentage:</strong> <span style='color:red'>" + f(d[1]) + "</span><br><strong>Coliform Count:</strong> <span style='color:red'>" + f2(d[2])+"</span><br><strong>Category:</strong> <span style='color:red'>"+category+"</span><br><strong>Rank:</strong> <span style='color:red'>"+(parseInt(i)+1).toString()+"</span><br><strong>Date:</strong> <span style='color:red'>"+d[3]+"</span>";
	    });
		var svg = d3.select("#svgdiv1").append("svg").attr("width", divwidth).attr("height", divheight).append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")");
		svg.call(tip);
		// Add the valueline path.
	    /*svg.append("path")
	        .attr("class", "line")
	        .style("stroke-dasharray", ("3, 3"))
	        .attr("d", valueline(categdata));*/
	    svg.selectAll("dot")
        	.data(categdata)
      	.enter().append("circle")
      	.attr("class",function(d){if (d[0]==samplepointId) return 'thisCircle';return 'normalCircle';})
        .attr("r", 3.5)
        .attr("cx", function(d) { return x(d[0]); })
        .attr("cy", function(d) { return y(d[1]); })
        .on('mouseover', tip.show).on('mouseout',tip.hide).on('contextmenu',function(d){d3.event.preventDefault();gmap.setZoom(17);
        gmap.panTo(spatialPoints.get(d[0]).getPosition());animateMarker(d[0]);}).on('click',function(d){var vizparameters={};vizparameters.code=d[0];vizparameters.date=d[3];vizparameters.category=category;visualizeDataFromParameters(vizparameters);});
		svg.append("g")
	      .attr("class", "y axis")
	      .call(yAxis);
		svg.append("g").attr("class", "x axis").attr("transform", "translate(0," + height + ")").call(xAxis);
		svg.append("text")
	      .attr("transform", "rotate(-90)")
	      .attr("y", 0 - margin.left)
	      .attr("x",0 - (height / 2))
	      .attr("dy", "1em")
	      .style("text-anchor", "middle")
	      .text("Coliform %");
		svg.append("text")             
	      .attr("transform",
	            "translate(" + (width/2) + " ," + 
	                           (height +(1.5*margin.top)) + ")")
	      .style("text-anchor", "middle")
	      .text("Samplepoints");
		svg.append("text")
        .attr("x", (width / 2))             
        .attr("y", 0 - (margin.top / 2))
        .attr("text-anchor", "middle")  
        .style("font-size", "12px")
        .style("font-weight", "bold")
        .style("text-decoration", "underline")  
        .text("All Neighborhoods");
   }
   
   function visualizeEnvSameNeighborhood(samplePointId,date,category,neighborhood){
	   var envvariable=$('#environsel').find(":selected").text();
	   var data=JSON.parse(exp.getEnvAllNeighborhood(date,envvariable,category));
	   clearEnvCircles();
	   var pos=null;
	   for (var i=0;i<data.length;i++){
		   var color='#000000';
		   var strokeOp=1;
		   var fillOp=1;
		   //selected+sameneighbhorhood
		   if(data[i][0]==samplePointId||data[i][3]==neighborhood){
			   strokeOp=.5;
			   fillOp=.5;
			   if (data[i][0]==samplePointId)
				   color='#FF0000';
		   }
		   var sampCircle = new google.maps.Circle({
	            strokeColor: color,
	            strokeOpacity: strokeOp,
	            strokeWeight: 2,
	            fillColor: color,
	            fillOpacity: fillOp,
	            map: gmap3,
	            center: spatialPoints.get(data[i][0]).getPosition(),
	            radius: 2
	       });
		   sampCircle.set("sid",data[i][0]);
		   sampCircle.set("value",data[i][1]);
		   sampCircle.set("date",data[i][2]);
		   sampCircle.set("neighborhood",data[i][3]);
		   sampCircle.set("isNeighb",false);
		   sampCircle.set('selected',false);
		   sampCircle.set('category',category);
		   sampCircle.set('rank',0);
		   if (data[i][0]==samplePointId){
			   pos=spatialPoints.get(data[i][0]).getPosition();
			   sampCircle.set('selected',true);
		   }
		   if (data[i][3]==neighborhood)
			   sampCircle.set("isNeighb",true);
		   google.maps.event.addListener(sampCircle,'rightclick',  function(mouseEvent){
			    gmap.setZoom(17);
		        gmap.panTo(spatialPoints.get(this.get('sid')).getPosition());
		        animateMarker(this.get('sid'));
		   });
		   google.maps.event.addListener(sampCircle,'click',  function(mouseEvent){
			    if(!this.get('isNeighb')){
			    	this.set('isNeighb',true);
			    	normalizeEnvCircles();
			    	//do the same for experimental circles
			    	neighborhoodmap.get(this.get("sid")).set('isNeighb',true);
			    	normalizeCircles();
			    }
			    else{
			    	var vizparameters={};
			    	vizparameters.code=this.get("sid");
			    	vizparameters.date=this.get("date");
			    	vizparameters.category=this.get("category");
			    	visualizeDataFromParameters(vizparameters);
			    }
		   });
		   sampCircle.addListener('mouseover', function() {
			   if(this.get('isNeighb')){
			       var divstring='<div><span>Code:'+this.get("sid")+'</span><br><span>Env Variable:'+$('#environsel').find(":selected").text()+'</span><br><span>Value:'+this.get('value')+'</span><br><span>Date:'+this.get('date')+'</span><br><span>Neighborhood:'+this.get('neighborhood')+'</span><br><span>Rank:'+this.get('rank')+'</span></div>';
			       infowindow.setContent(divstring);
			       infowindow.setPosition(this.getCenter());
				   infowindow.open(gmap3);
			   } 
		   });
		   sampCircle.addListener('mouseout', function() {
			    infowindow.close();
		   });
		   neighborhoodenvmap.set(data[i][0],sampCircle);
	   }
	   gmap3.setZoom(18);
  	   gmap3.panTo(pos);
	   normalizeEnvCircles();
   }
   
   function visualizeEnvDate(samplePointId,date){
	   var envvariable=$('#environsel').find(":selected").text();
	   var data=JSON.parse(exp.getEnvValues(samplePointId,envvariable));
	   var selectedDate=new Date(date);
	   d3.select('#svgdiv4').selectAll("svg").remove();
  		var divwidth=parseInt(d3.select("#svgdiv4").style("width"), 10);
		var divheight=parseInt(d3.select("#svgdiv4").style("height"), 10);
		var margin={};
		margin.left=.2*divwidth;
		margin.right=.1*divwidth;
		margin.top=.1*divheight;
		margin.bottom=.2*divheight;
		var width=divwidth-margin.left-margin.right
		var height=divheight-margin.top-margin.bottom;
		var x = d3.scale.ordinal().rangeRoundBands([0, width], .1);
		var y = d3.scale.linear().range([height, 0]);
		// Define the line
	   	var valueline = d3.svg.line()
	       .x(function(d) { return x(d[0]); })
	       .y(function(d) { return y(d[1]); });
		var dates=[];
		data.forEach(function(d){
			dates.push(d[0]);
		});
		x.domain(dates);
		y.domain([0,5]);
		var yAxis = d3.svg.axis().scale(y).orient("left").ticks(5);
		var xAxis = d3.svg.axis().scale(x).orient("bottom").tickValues([]);
		var tip = d3.tip().attr('class', 'd3-tip').offset([-10, 0]).html(function(d,i) {
			return "<strong>Date:</strong> <span style='color:red'>" + d[0] + "</span><br><strong>Value:</strong> <span style='color:red'>" + d[1] + "</span>";
	    });
		var svg = d3.select("#svgdiv4").append("svg").attr("width", divwidth).attr("height", divheight).append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")");
		svg.call(tip);
		// Add the valueline path.
	    svg.append("path")
	        .attr("class", "line")
	        .style("stroke-dasharray", ("3, 3"))
	        .attr("d", valueline(data));
	    svg.selectAll("dot")
       	.data(data)
     	.enter().append("circle")
     	.attr("class",function(d){var thisd=new Date(d[0]);if (thisd.getTime()==selectedDate.getTime()){return 'thisCircle'};return 'normalCircle';})
       .attr("r", 3.5)
       .attr("cx", function(d) { return x(d[0]); })
       .attr("cy", function(d) { return y(d[1]); })
       .on('mouseover', tip.show).on('mouseout', tip.hide).on('click',function(d){var vizparameters={};vizparameters.code=samplePointId;vizparameters.date=d[0];visualizeDataFromParameters(vizparameters);});
		svg.append("g")
	      .attr("class", "y axis")
	      .call(yAxis)
		svg.append("g").attr("class", "x axis").attr("transform", "translate(0," + height + ")").call(xAxis);
		svg.append("text")
	      .attr("transform", "rotate(-90)")
	      .attr("y", 0 - margin.left)
	      .attr("x",0 - (height / 2))
	      .attr("dy", "1em")
	      .style("text-anchor", "middle")
	      .text(envvariable); 
		svg.append("text")             
	      .attr("transform",
	            "translate(" + (width/2) + " ," + 
	                           (height +(1.5*margin.top)) + ")")
	      .style("text-anchor", "middle")
	      .text("Date");
		svg.append("text")
       .attr("x", (width / 2))             
       .attr("y", 0 - (margin.top / 2))
       .attr("text-anchor", "middle")  
       .style("font-size", "12px")
       .style("font-weight", "bold")
       .style("text-decoration", "underline")  
       .text("All Dates");
   }
   
   function visualizeRainfallData(samplePointId,date){
	   var data=JSON.parse(exp.getRainFallData(date,samplePointId));
	   var selectedDate=new Date(date);
	   d3.select('#svgdiv5').selectAll("svg").remove();
  		var divwidth=parseInt(d3.select("#svgdiv5").style("width"), 10);
		var divheight=parseInt(d3.select("#svgdiv5").style("height"), 10);
		var margin={};
		margin.left=.2*divwidth;
		margin.right=.1*divwidth;
		margin.top=.1*divheight;
		margin.bottom=.2*divheight;
		var width=divwidth-margin.left-margin.right
		var height=divheight-margin.top-margin.bottom;
		var x = d3.scale.ordinal().rangeRoundBands([0, width], .1);
		var y = d3.scale.linear().range([height, 0]);
		// Define the line
	   	var valueline = d3.svg.line()
	       .x(function(d) { return x(d[0]); })
	       .y(function(d) { return y(d[1]); });
		var dates=[];
		data.forEach(function(d){
			dates.push(d[0]);
		});
		x.domain(dates);
		var max=Math.max.apply(null, data.map(function (e) { return e[1]}));
		var min=Math.min.apply(null, data.map(function (e) { return e[1]}));
		y.domain([Math.min(0,min),max]);
		var yAxis = d3.svg.axis().scale(y).orient("left").ticks(5).tickFormat(d3.format(".1f"));
		var xAxis = d3.svg.axis().scale(x).orient("bottom").tickValues([]);
		var tip = d3.tip().attr('class', 'd3-tip').offset([-10, 0]).html(function(d,i) {
			return "<strong>Date:</strong> <span style='color:red'>" + d[0] + "</span><br><strong>Temperature:</strong> <span style='color:red'>" + d[1] + "</span>";
	    });
		var svg = d3.select("#svgdiv5").append("svg").attr("width", divwidth).attr("height", divheight).append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")");
		svg.call(tip);
		// Add the valueline path.
	    svg.append("path")
	        .attr("class", "line")
	        .style("stroke-dasharray", ("3, 3"))
	        .attr("d", valueline(data));
	    svg.selectAll("dot")
       	.data(data)
     	.enter().append("circle")
     	.attr("class",function(d){var thisd=new Date(d[0]);if (thisd.getTime()==selectedDate.getTime()){return 'thisCircle'};return 'normalCircle';})
       .attr("r", 3.5)
       .attr("cx", function(d) { return x(d[0]); })
       .attr("cy", function(d) { return y(d[1]); })
       .on('mouseover', tip.show).on('mouseout', tip.hide).on('click',function(d){var vizparameters={};vizparameters.code=currsid;vizparameters.date=d[0];visualizeDataFromParameters(vizparameters);});
		svg.append("g")
	      .attr("class", "y axis")
	      .call(yAxis)
		svg.append("g").attr("class", "x axis").attr("transform", "translate(0," + height + ")").call(xAxis);
		svg.append("text")
	      .attr("transform", "rotate(-90)")
	      .attr("y", 0 - margin.left)
	      .attr("x",0 - (height / 2))
	      .attr("dy", "1em")
	      .style("text-anchor", "middle")
	      .text('Average Temperature (F)'); 
		svg.append("text")             
	      .attr("transform",
	            "translate(" + (width/2) + " ," + 
	                           (height +(1.5*margin.top)) + ")")
	      .style("text-anchor", "middle")
	      .text("Date");
		svg.append("text")
       .attr("x", (width / 2))             
       .attr("y", 0 - (margin.top / 2))
       .attr("text-anchor", "middle")  
       .style("font-size", "12px") 
       .style("font-weight", "bold")
       .style("text-decoration", "underline")  
       .text("Average Temperature");
   }

   function visualizeSamplePointDate(alldata){	
	    var datedata=alldata.datedata;
	    var category=alldata.category;
	    var samplepointId=alldata.sid;
	    var neighborhood=alldata.neighborhood;
	    var selectedDate=new Date(alldata.date);
	    d3.select('#svgdiv2').selectAll("svg").remove();
   		var divwidth=parseInt(d3.select("#svgdiv2").style("width"), 10);
		var divheight=parseInt(d3.select("#svgdiv2").style("height"), 10);
		var margin={};
		margin.left=.2*divwidth;
		margin.right=.1*divwidth;
		margin.top=.1*divheight;
		margin.bottom=.2*divheight;
		var width=divwidth-margin.left-margin.right
		var height=divheight-margin.top-margin.bottom;
		var x = d3.scale.ordinal().rangeRoundBands([0, width], .1);
		var y = d3.scale.linear().range([height, 0]);
		// Define the line
	   	var valueline = d3.svg.line()
	       .x(function(d) { return x(d[0]); })
	       .y(function(d) { return y(d[1]); });
		var dates=[];
		datedata.forEach(function(d){
			dates.push(d[0]);
		});
		x.domain(dates);
		y.domain([0,1]);
		var yAxis = d3.svg.axis().scale(y).orient("left").ticks(5).tickFormat(f);
		var xAxis = d3.svg.axis().scale(x).orient("bottom").tickValues([]);
		var tip = d3.tip().attr('class', 'd3-tip').offset([-10, 0]).html(function(d,i) {
			return "<strong>Date:</strong> <span style='color:red'>" + d[0] + "</span><br><strong>Coliform Percentage:</strong> <span style='color:red'>" + f(d[1]) + "</span><br><strong>Coliform Count:</strong> <span style='color:red'>" + f2(d[2])+"</span>";
	    });
		var svg = d3.select("#svgdiv2").append("svg").attr("width", divwidth).attr("height", divheight).append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")");
		svg.call(tip);
		// Add the valueline path.
	    svg.append("path")
	        .attr("class", "line")
	        .style("stroke-dasharray", ("3, 3"))
	        .attr("d", valueline(datedata));
	    svg.selectAll("dot")
        	.data(datedata)
      	.enter().append("circle")
      	.attr("class",function(d){var thisd=new Date(d[0]);if (thisd.getTime()==selectedDate.getTime()){return 'thisCircle'};return 'normalCircle';})
        .attr("r", 3.5)
        .attr("cx", function(d) { return x(d[0]); })
        .attr("cy", function(d) { return y(d[1]); })
        .on('mouseover', tip.show).on('mouseout', tip.hide).on('click',function(d){var vizparameters={};vizparameters.code=samplepointId;vizparameters.date=d[0];vizparameters.category=category;visualizeDataFromParameters(vizparameters);});
		svg.append("g")
	      .attr("class", "y axis")
	      .call(yAxis)
		svg.append("g").attr("class", "x axis").attr("transform", "translate(0," + height + ")").call(xAxis);
		svg.append("text")
	      .attr("transform", "rotate(-90)")
	      .attr("y", 0 - margin.left)
	      .attr("x",0 - (height / 2))
	      .attr("dy", "1em")
	      .style("text-anchor", "middle")
	      .text("Coliform %"); 
		svg.append("text")             
	      .attr("transform",
	            "translate(" + (width/2) + " ," + 
	                           (height +(1.5*margin.top)) + ")")
	      .style("text-anchor", "middle")
	      .text("Date");
		svg.append("text")
        .attr("x", (width / 2))             
        .attr("y", 0 - (margin.top / 2))
        .attr("text-anchor", "middle")  
        .style("font-size", "12px")
        .style("font-weight", "bold")
        .style("text-decoration", "underline")  
        .text("All Dates");
   }
   
   //visualize neighborhood data
   function visualizeNeighborhoodData(alldata){
	    var neighbdata=alldata.neighborhooddata;
	    var category=alldata.category;
	    var samplepointId=alldata.sid;
	    var neighborhood=alldata.neighborhood;
	    var date=alldata.date;
	    d3.select('#svgdiv3').selectAll("svg").remove();
   		var divwidth=parseInt(d3.select("#svgdiv3").style("width"), 10);
		var divheight=parseInt(d3.select("#svgdiv3").style("height"), 10);
		var margin={};
		margin.left=.2*divwidth;
		margin.right=.1*divwidth;
		margin.top=.1*divheight;
		margin.bottom=.2*divheight;
		var width=divwidth-margin.left-margin.right
		var height=divheight-margin.top-margin.bottom;
		var x = d3.scale.ordinal().rangeRoundBands([0, width], .1);
		var y = d3.scale.linear().range([height, 0]);
		// Define the line
	   	var valueline = d3.svg.line()
	       .x(function(d) { return x(d[0]); })
	       .y(function(d) { return y(d[1]); });
		var neighbnames=[];
		neighbdata.forEach(function(d){
			neighbnames.push(d[0]);
		});
		x.domain(neighbnames);
		y.domain([0, 1]);
		var yAxis = d3.svg.axis().scale(y).orient("left").ticks(5).tickFormat(f);
		var xAxis = d3.svg.axis().scale(x).orient("bottom").tickValues([]);
		var tip = d3.tip().attr('class', 'd3-tip').offset([-10, 0]).html(function(d,i) {
			return "<strong>Code:</strong> <span style='color:red'>" + d[0] + "</span><br><strong>Coliform Percentage:</strong> <span style='color:red'>" + f(d[1]) + "</span><br><strong>Coliform Count:</strong> <span style='color:red'>" + f2(d[2])+"</span><br><strong>Neighborhood:</strong> <span style='color:red'>"+neighborhood+"</span><br><strong>Rank:</strong> <span style='color:red'>"+(parseInt(i)+1).toString()+"</span><br><strong>Date:</strong> <span style='color:red'>"+d[3]+"</span>";
	    });
		var svg = d3.select("#svgdiv3").append("svg").attr("width", divwidth).attr("height", divheight).append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")");
		svg.call(tip);
		// Add the valueline path.
	    svg.append("path")
	        .attr("class", "line")
	        .style("stroke-dasharray", ("3, 3"))
	        .attr("d", valueline(neighbdata));
	    svg.selectAll("dot")
        	.data(neighbdata)
      	.enter().append("circle")
      	.attr("class",function(d){if (d[0]==samplepointId) return 'thisCircle';return 'normalCircle';})
        .attr("r", 3.5)
        .attr("cx", function(d) { return x(d[0]); })
        .attr("cy", function(d) { return y(d[1]); })
        .on('mouseover', tip.show).on('mouseout', tip.hide).on('contextmenu',function(d){d3.event.preventDefault();gmap.setZoom(17);
        gmap.panTo(spatialPoints.get(d[0]).getPosition());animateMarker(d[0]);}).on('click',function(d){var vizparameters={};vizparameters.code=d[0];vizparameters.date=d[3];vizparameters.category=category;visualizeDataFromParameters(vizparameters);});
		svg.append("g")
	      .attr("class", "y axis")
	      .call(yAxis);
		svg.append("g").attr("class", "x axis").attr("transform", "translate(0," + height + ")").call(xAxis);
		svg.append("text")
	      .attr("transform", "rotate(-90)")
	      .attr("y", 0 - margin.left)
	      .attr("x",0 - (height / 2))
	      .attr("dy", "1em")
	      .style("text-anchor", "middle")
	      .text("Coliform %");
		svg.append("text")             
	      .attr("transform",
	            "translate(" + (width/2) + " ," + 
	                           (height +(1.5*margin.top)) + ")")
	      .style("text-anchor", "middle")
	      .text("Samplepoints");
		
		svg.append("text")
        .attr("x", (width / 2))             
        .attr("y", 0 - (margin.top / 2))
        .attr("text-anchor", "middle")  
        .style("font-size", "12px") 
        .style("font-weight", "bold") 
        .style("text-decoration", "underline")  
        .text("Same Neighborhood");
   }
   
   function powerOfTen(d) {
	   return d / Math.pow(10, Math.ceil(Math.log(d) / Math.LN10 - 1e-12)) === 1;
   }
   
   function startNeighborhoodVisualization(){
	   if($('#vizneighborhoodselect').has('option').length != 0 && $('#vizneighborhoodcategselect').has('option').length != 0 && $('#vizneighborhoodsamplepointselect').has('option').length != 0 && $('#vizneighborhoodsamplepointdateselect').has('option').length != 0){
	   		var neighborhood=$('#vizneighborhoodselect').find(":selected").text();
	   		var categ=$('#vizneighborhoodcategselect').find(":selected").text(); 
	   		var code=$('#vizneighborhoodsamplepointselect').find(":selected").text(); 
	   		var date=$('#vizneighborhoodsamplepointdateselect').find(":selected").text(); 
	   		var vizparameters={};
	   		vizparameters.neighborhood=neighborhood;
	   		vizparameters.category=categ;
	   		vizparameters.code=code;
	   		vizparameters.date=date;
	   		visualizeDataFromParameters(vizparameters);
	   }
   }
   
   function startVisualization(){
	   var sampoint=$('#vizpointselect').find(":selected").text();
	   var date=$('#vizdateselect').find(":selected").text();
	   if (!sampoint || sampoint.length==0)
		   return;
	   var vizparameters={};
	   vizparameters.code=sampoint;
	   vizparameters.date=date;
	   vizparameters.category=$('#vizcategselect').find(":selected").text();
	   visualizeDataFromParameters(vizparameters);
   }
   
   function visualizeData(alldata){
	   $("#environsel").prop("disabled", false);
	   //remove all tooltips
	   d3.select(".d3-tip").remove();
	   var text="<b>Code:</b> "+alldata.sid+"  <b>Neighborhood:</b> "+alldata.neighborhood+"  <b>Category:</b> "+alldata.category+"  <b>Date: </b>"+alldata.date;
	   currsid=alldata.sid;
	   currdate=alldata.date;
	   currdate=alldata.date;
	   currcategory=alldata.category;
	   currneighborhood=alldata.neighborhood;
	   d3.select('#vizheader').html(text);
	   visualizeCategData(alldata);
	   visualizeSamplePointDate(alldata);
	   //visualizeNeighborhoodData(alldata);
	   visualizeNeighborhoodDataInMap(alldata);
	   visualizeEnvDate(alldata.sid,alldata.date);
	   visualizeRainfallData(alldata.sid,alldata.date);
	   visualizeEnvSameNeighborhood(alldata.sid,alldata.date,alldata.category,alldata.neighborhood);
	   var imageForData=exp.getImageForData(alldata.sid,alldata.date);
	   $('#recimage').attr("src","");
	   if(imageForData.length!=0){
		   $('#recimage').attr("src","../data/recordimages/"+imageForData);
	   }
   }
   
   function visualizeDataFromParameters(vizparameters){
	   var response=JSON.parse(exp.getVisualizationData(vizparameters));
	   visualizeData(response);
   }
   
   function visualizeSamplePoint(){
	   var spoint=$('#spoint_id').val();
	   var date=$('#dateselect').find(":selected").text();
	   var vizparameters={};
	   vizparameters.code=spoint;
	   vizparameters.date=date;
	   visualizeDataFromParameters(vizparameters);
   }
   
   function openTab(evt, tabName) {
	    // Declare all variables
	    var i, tabcontent, tablinks;

	    // Get all elements with class="tabcontent" and hide them
	    tabcontent = document.getElementsByClassName("tabcontent");
	    for (i = 0; i < tabcontent.length; i++) {
	        tabcontent[i].style.display = "none";
	    }

	    // Get all elements with class="tablinks" and remove the class "active"
	    tablinks = document.getElementsByClassName("tablinks");
	    for (i = 0; i < tablinks.length; i++) {
	        tablinks[i].className = tablinks[i].className.replace(" active", "");
	    }

	    // Show the current tab, and add an "active" class to the button that opened the tab
	    document.getElementById(tabName).style.display = "block";
	    evt.currentTarget.className += " active";
   }
   
   //upload image file
   function uploadImage(){
	    var imagefile=exp.openImageFile();
	    $('#img_text').val(imagefile);
   }
   
   //upload sample point image file
   function uploadSamplePointImage(){
	    var imagefile=exp.openImageFile();
	    $('#sampimg_text').val(imagefile);
   }
   
   //upload experimental records
   function uploadExperimentalRecords(){
	   $('#edit_modal').modal('hide');
	   var response=exp.uploadExperimentalRecords();
	   alert(response);
   }
   
   //upload Environmental records
   function uploadEnvironmentalRecords(){
	   $('#edit_modal').modal('hide');
	   var response=exp.uploadEnvironmentalRecords();
	   alert(response);
   }   
   //load the download modal
   function download(){
	   $('#download_modal').modal();
   }
   //select the outputfolder
   function selectOutputFolder(){
	   var outfolder=exp.selectOutputFolder();
	   $('#out_folder').val(outfolder);
   }
   //download shape file
   function downloadShape(){
	   if ($('#out_folder').val().length==0){
		   alert('output folder cannot be empty');
		   return;
	   }
	   var date=$('#download_date').val();
	   var filename=prompt("Please enter filename", "");
	   if (filename != null && filename != "") {
	   		alert(exp.downloadShape(date,filename,$('#out_folder').val()));
	   }
   }
   function editData(){
	   $('#edit_modal').modal();
   }
   function displayEnvData(){
	   visualizeEnvDate(currsid,currdate);
	   visualizeEnvSameNeighborhood(currsid,currdate,currcategory,currneighborhood);
   }
   function recenterMap(){
	   if($('#latlontext').val().length>0){
		   var coords=$('#latlontext').val().split(',');
		   gmap.setCenter({lat:parseFloat(coords[1]),lng:parseFloat(coords[0])});
	   }
	   
	   html2canvas($('#map').get(0),{useCORS: true,logging:true}).then(function(canvas) {
			//window.open(canvas.toDataURL());
			exp.saveCanvas(canvas.toDataURL().split(',',2)[1]);
		});
   }
   function uploadKML(){
   	   var kmldat=exp.uploadKMLFile();
   	   if (kmldat.length==0)
   		   return;
   	   clearKML();
   	   kmldat=JSON.parse(kmldat);
   	   for (i=0;i<kmldat.length;i++){
   		   var dat=kmldat[i];
   		   var obj=null;
   		   //marker
   		   if (dat.type=='Point'){
   				obj = new google.maps.Marker({
   					position: dat.coordinates,
   					map: gmap,
   					draggable:false,
   					icon: {
   						scaledSize : new google.maps.Size(30, 30),
   						url : 'http://maps.google.com/mapfiles/kml/paddle/ylw-circle.png'
   					}
   				});
   				obj.set('pos',dat.coordinates);
   		   }
   		   else if (dat.type=='LineString'){
				obj = new google.maps.Polyline({
					path: dat.coordinates,
					map: gmap,
					geodesic: true,
			        strokeColor: '#FF0000',
			        strokeOpacity: 1.0,
			        strokeWeight: 2
				});
				obj.set('pos',dat.coordinates[0]);
		   }
   		   else if(dat.type=='Polygon'){
   				obj = new google.maps.Polygon({
					paths: dat.coordinates,
					map: gmap,
		        	strokeColor: '#FF0000',
		        	strokeOpacity: .7,
		        	strokeWeight: 2,
					fillColor: '#FF0000',
			        fillOpacity: 0.35
				});
   				obj.set('pos',dat.coordinates[0]);
   		   }
   		   obj.set('string',dat.name+"\n"+dat.description);
   		   obj.addListener('mouseover', function(){
  				infowindow.setContent(this.get('string'));
  				infowindow.setPosition(this.get('pos'));
  				infowindow.open(gmap);
  		   });
  		   obj.addListener('mouseout', function() {
		        infowindow.close();
		   });
   		   kmlData.push(obj);
   	   }
   }
   function clearKML(){
	   for (i=0;i<kmlData.length;i++){
		   kmlData[i].setMap(null);
	   }
	   kmlData=[];
   }
   
   function performWaterPointSpatialQuery(){
	   $('#datemodal').modal('hide');
	   $('#timeslider').val(0);
	   $('#yearmonth').val(datesliders[0]);
	   var spoint=$('#spoint_id').val();
	   spatialObject={};
	   spatialObject.type='Point';
	   spatialObject.coordinates=[spatialPoints.get(spoint).getPosition().lng(),spatialPoints.get(spoint).getPosition().lat()];
	   spatialObject.date=datesliders[0];
	   var stats=JSON.parse(exp.getStats(JSON.stringify(spatialObject)));
	   generateStatsTable(stats);
	   $('#stats_modal').modal();
   }
   
   function spatialQueryFromTable(spoint){
	   spatialObject.type='Point';
	   spatialObject.coordinates=[spatialPoints.get(spoint).getPosition().lng(),spatialPoints.get(spoint).getPosition().lat()];
	   spatialObject.date=$('#yearmonth').val();
	   var stats=JSON.parse(exp.getStats(JSON.stringify(spatialObject)));
	   generateStatsTable(stats);
   }
   
   
   function generateStatsTable(statData){
	   d3.select('#statstable').select('tbody').selectAll('tr').remove();
	   var rows=d3.select('#statstable').select('tbody').selectAll('tr').data(statData).enter().append('tr');
	   rows.selectAll('td').data(function(h){
		   return [h.name,h.neighborhood,h.category,h.perc_change,h.neighb_rank,h.categ_rank,h.coliform_log,h.self_rank];
	   }).enter().append('td').text(function(d){
		   return d;
	   }).style("color",function(d,i){
		   if(i==3){
			   if (d!='N/A'){
				   if(parseFloat(d)>0)
					   return 'red';
				   return 'green';
			   }
		   }
		   if(i==0){
			   return 'blue';
		   }
		   if (i==2){
			   if (d=='Pipe/Cistern')
				   return '#B3B300';
			   if(d=='Ocean')
				   return '#0BB5FF';
			   if (d=='Drainage')
				   return '#32CD32';
			   if (d=='Combined')
				   return '#e5e5e5';
		   }
	   }).style("text-decoration",function(d,i){
		   if(i==0){
			   return 'underline';
		   }
	   }).on("mouseover",function(d,i){
		   if(i==0){
			   d3.select(this).style("cursor", "pointer"); 
		   }
	   }).on("mouseout",function(d,i){
		   if(i==0){
			   d3.select(this).style("cursor", "default"); 
		   }
	   }).on("click",function(d,i){
		   if(i==0){
			   spatialQueryFromTable(d);
		   }
	   }).on("contextmenu",function(d,i){
		   if(i==0){
			   $('#stats_modal').modal('hide');
			   d3.event.preventDefault();
			   gmap.setZoom(17);
		       gmap.panTo(spatialPoints.get(d).getPosition());
		       animateMarker(d);
		       setTimeout(function(){$('#stats_modal').modal();}, 2500);
		   }
	   });
   }
   
   function timeslidechange(){
       $('#yearmonth').val(datesliders[$('#timeslider').val()]);
       spatialObject.date=$('#yearmonth').val();
       var stats=JSON.parse(exp.getStats(JSON.stringify(spatialObject)));
       generateStatsTable(stats);
   }
   
   function openhmapParameters(){
	   $("#hmapneighborhoods").val('All');
	   $('#heatmap_modal').modal();
	   hmaptimeslidechange();
   }
   
   function hmaptimeslidechange(){
	   $('#hmapyearmonth').val(datesliders[$('#hmaptimeslider').val()]);
	   generateHeatmap();
   }
   
   function generateHeatmap(){
	   var hmapObject={};
	   hmapObject.date=$('#hmapyearmonth').val();
	   hmapObject.category=$('#hmapcategories').val();
	   hmapObject.neighborhood=$('#hmapneighborhoods').val();
	   var hdata=JSON.parse(exp.getHeatmapData(JSON.stringify(hmapObject)));
	   var hmapdata=[];
	   for (i=0;i<hdata.length;i++){
		   hmapdata.push({location:spatialPoints.get(hdata[i][0]).getPosition(),weight:hdata[i][1]});
	   }
	   hmaplayer.setData(hmapdata);
	   hmaplayer.setMap(gmap);
   }
   
   function toggleWaterPoints(val){
	   if(val=='hide'){
		   spatialPoints.values().forEach(function(d){
			   d.setMap(null);
		   });
	   }
	   else{
		   spatialPoints.values().forEach(function(d){
			   d.setMap(gmap);
		   });
	   }
   }
   
   function removeHeatMap(){
	   hmaplayer.setMap(null);
   }
   
   $(document).on('hide.bs.modal','#heatmap_modal', function () {
	   toggleWaterPoints('unhide');
	});
   
   function downloadStats(){
	   var sampoint=$('#spoint_id').val();
	   var date=$('#dateselect').find(":selected").text();
	   statobj={dates:date,pointid:sampoint};
	   alert(exp.downloadStats(JSON.stringify(statobj)));
   }
   
</script>
</head>
<body style="background-color: #98AFC7;" onload="initialize()">
	<div class="container-fluid contfill">
		<div class="row contfill">
			<div class="col-md-7 contfill">
				<!-- This row for visualizations and other control options height 65%-->
				<div class="row vizfill">
					<!-- Map Holder-->
					<div class="contfill">
						<!-- Map-->
						<div id="map"></div>
					</div>
				</div>
				<div class="row" style="min-height: 5%; height: 5%;">
					<div class="col-md-3">
						<div class="col-md-7">
							<input type="text" class="form-control" id="latlontext"
								placeholder="Lon,Lat">
						</div>
						<div class="col-md-5">
							<button type="button" class="btn btn-primary"
								onclick="recenterMap()">Re-Center</button>
						</div>
					</div>
					<div class="col-md-4">
						<div class="col-md-6">
							<button type="button" class="btn btn-primary"
								onclick="uploadKML()">Upload KML</button>
						</div>
						<div class="col-md-6">
							<button type="button" class="btn btn-primary"
								onclick="clearKML()">Clear KML</button>
						</div>
					</div>
					<div class="col-md-2">
						<button type="button" class="btn btn-primary"
							onclick="openhmapParameters()">Heatmap</button>
					</div>
				</div>
				<!-- This row for additional control and other viz options height 30%-->
				<div class="row optionfill">
					<div class="col-md-3"
						style="min-height: 100%; height: 100%; margin-top: 1%;">
						<img src="" alt="Image" height="100%" width="100%" id="recimage">
					</div>
					<div id="envselect" class="col-md-1" style="margin-top: 1%;">
						<select id="environsel" onchange="displayEnvData()" disabled>
							<option val="mud">mud</option>
							<option val="water">water</option>
							<option val="trash">trash</option>
							<option val="activity">activity</option>
						</select>
					</div>
					<div class="col-md-8"
						style="margin-top: 1%; background-color: #F1F1F1; height: 100%;">
						<div id="svgdiv4" class="col-md-6" style="height: 100%;"></div>
						<div id="svgdiv5" class="col-md-6" style="height: 100%;"></div>
					</div>
				</div>
			</div>
			<!-- Control Options-->
			<div class="col-md-5 contfill">
				<div id="vizbigdiv" style="height: 100%; min-height: 100%;">
					<div id="vizholder"
						style="height: 90%; min-height: 90%; background-color: #F1F1F1;">
						<div class="row" style="height: 10%; min-height: 10%;">
							<h5>
								<p id="vizheader" align="center"></p>
							</h5>
						</div>
						<div class="row" style="height: 45%; min-height: 45%;">
							<div id="svgdiv1" class="col-md-6" style="height: 100%;"></div>
							<div id="svgdiv2" class="col-md-6" style="height: 100%;"></div>
						</div>
						<div class="row" style="height: 45%; min-height: 45%;">
							<div id="svgdiv3" class="col-md-6" style="height: 100%;">
								<div style="height: 10%;">
									<h4>Experimental Data Same Neighborhood</h4>
								</div>
								<div style="height: 2%;"></div>
								<div style="height: 85%;">
									<div id="map2"></div>
								</div>
							</div>
							<div id="svgdiv6" class="col-md-6" style="height: 100%;">
								<div style="height: 10%;">
									<h4>Environmental Data Same Neighborhood</h4>
								</div>
								<div style="height: 2%;"></div>
								<div style="height: 85%;">
									<div id="map3"></div>
								</div>
							</div>
						</div>
					</div>
					<div id="vizparameters"
						style="height: 7%; min-height: 7%; margin-top: 1%;">
						<div class="row">
							<div class="col-md-3">
								<button type="button" class="btn btn-primary"
									onclick="download()">Downloads</button>
							</div>
							<div class="col-md-3">
								<button type="button" class="btn btn-primary"
									onclick="editData()">Edit Data</button>
							</div>
							<div class="col-md-6">
								<button type="button" class="btn btn-primary"
									onclick="openVizParameters()" id="vizparambutton">Visualization
									Parameters</button>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!-- Modal to CRUD sample points-->
		<div id="samplepointmodal" class="modal fade" role="dialog">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal">&times;</button>
						<h4 class="modal-title">Sample Point</h4>
					</div>
					<div class="modal-body">
						<div class="row">
							<div class="col-md-3">
								<b>Point Id:</b>
							</div>
							<div class="col-md-3">
								<input type="text" class="form-control"
									id="create_point_id_text">
							</div>
						</div>
						<div class="row" style="margin-top: 1%;">
							<div class="col-md-3">
								<b>Neighborhood:</b>
							</div>
							<div class="col-md-6">
								<input type="text" class="form-control"
									id="create_point_neighborhood_text">
							</div>
						</div>
						<div class="row" style="margin-top: 1%;">
							<div class="col-md-3">
								<b>Type:</b>
							</div>
							<div class="col-md-6">
								<input type="text" class="form-control"
									id="create_point_type_text">
							</div>
						</div>
						<div class="row" style="margin-top: 1%;">
							<div class="col-md-3">
								<b>Address:</b>
							</div>
							<div class="col-md-6">
								<input type="text" class="form-control"
									id="create_point_address_text">
							</div>
						</div>
						<div class="row" style="margin-top: 1%;">
							<div class="col-md-3">
								<b>Postion:</b>
							</div>
							<div class="col-md-4">
								<div class="col-md-3">
									<b>Lat:</b>
								</div>
								<div class="col-md-9">
									<input type="text" class="form-control"
										id="create_point_lat_text">
								</div>
							</div>
							<div class="col-md-4">
								<div class="col-md-3">
									<b>Lon:</b>
								</div>
								<div class="col-md-9">
									<input type="text" class="form-control"
										id="create_point_lon_text">
								</div>
							</div>
						</div>
						<div class="row" style="margin-top: 1%;">
							<div class="col-md-3">
								<b>Category:</b>
							</div>
							<div class="col-md-9">
								<div class="col-md-6">
									<select class="form-control" id="create_point_categ_select"
										onchange="updateCategCreateText(this)">
										<option value="default">default</option>
										<option value="Pipe/Cistern">Pipe/Cistern</option>
										<option value="Ocean">Ocean</option>
										<option value="Drainage">Drainage</option>
										<option value="Combined">Combined</option>
									</select>
								</div>
								<div class="col-md-6">
									<input type="text" class="form-control"
										id="create_point_categ_text" value="default">
								</div>
							</div>
						</div>
						<div class="row" style="margin-top: 1%;">
							<div class="col-md-3">
								<b>Reservoir Capacity:</b>
							</div>
							<div class="col-md-9">
								<input type="text" class="form-control"
									id="create_point_reservoir_capacity_text">
							</div>
						</div>
						<div class="row" style="margin-top: 1%;">
							<div class="col-md-3">
								<b>Reservoir With Tap:</b>
							</div>
							<div class="col-md-9">
								<input type="text" class="form-control"
									id="create_point_reservoir_tap_text">
							</div>
						</div>
						<div class="row" style="margin-top: 1%;">
							<div class="col-md-3">
								<b>Covered:</b>
							</div>
							<div class="col-md-9">
								<input type="text" class="form-control"
									id="create_point_covered_text">
							</div>
						</div>
						<div class="row" style="margin-top: 1%;">
							<div class="col-md-3">
								<b>Water Used For Drinking:</b>
							</div>
							<div class="col-md-9">
								<input type="text" class="form-control"
									id="create_point_water_drinking_text">
							</div>
						</div>
						<div class="row" style="margin-top: 1%;">
							<div class="col-md-3">
								<b>Water Used For Bath:</b>
							</div>
							<div class="col-md-9">
								<input type="text" class="form-control"
									id="create_point_water_bath_text">
							</div>
						</div>
						<div class="row" style="margin-top: 1%;">
							<div class="col-md-3">
								<b>Image:</b>
							</div>
							<div class="col-md-4">
								<button type="button" class="btn btn-primary"
									onclick="uploadSamplePointImage()" id="upldsampimage">Upload
									Image</button>
							</div>
							<div class="col-md-4">
								<input type="text" class="form-control" id="sampimg_text"
									disabled>
							</div>
						</div>
						<div class="row" style="margin-top: 1%;">
							<div class="col-md-4">
								<button type="button" class="btn btn-primary"
									onclick="createNewSamplePoint()" id="new_samp_button">Create
									New Sample Point</button>
							</div>
							<div class="col-md-4">
								<button type="button" class="btn btn-primary"
									onclick="updateExistingSamplePoint()" id="update_samp_button">Update
									Sample Point</button>
							</div>
							<div class="col-md-4">
								<button type="button" class="btn btn-primary"
									onclick="deleteExistingSamplePoint()" id="delete_samp_button">Delete
									Sample Point</button>
							</div>
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
					</div>
				</div>
			</div>
		</div>
		<!-- Environmental record CRUD -->
		<div id="envrecordsmodal" class="modal fade" role="dialog">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal">&times;</button>
						<h4 class="modal-title">Environmental Record</h4>
					</div>
					<div class="modal-body">
						<div class="row" style="margin-top: 1%;">
							<div class="col-md-3">
								<b>Water:</b>
							</div>
							<div class="col-md-3">
								<input type="text" class="form-control" id="water_text">
							</div>
						</div>
						<div class="row" style="margin-top: 1%;">
							<div class="col-md-3">
								<b>Mud:</b>
							</div>
							<div class="col-md-3">
								<input type="text" class="form-control" id="mud_text">
							</div>
						</div>
						<div class="row" style="margin-top: 1%;">
							<div class="col-md-3">
								<b>Trash:</b>
							</div>
							<div class="col-md-3">
								<input type="text" class="form-control" id="trash_text">
							</div>
						</div>
						<div class="row" style="margin-top: 1%;">
							<div class="col-md-3">
								<b>Activity:</b>
							</div>
							<div class="col-md-3">
								<input type="text" class="form-control" id="activity_text">
							</div>
						</div>
						<div class="row" style="margin-top: 1%;">
							<div class="col-md-3">
								<b>Date:</b>
							</div>
							<div class="col-md-3">
								<input type="text" class="form-control" id="date_env_text">
							</div>
						</div>
						<div class="row" style="margin-top: 1%;">
							<div class="col-md-3">
								<b>Image:</b>
							</div>
							<div class="col-md-4">
								<button type="button" class="btn btn-primary"
									onclick="uploadImage()" id="upldimage">Upload Image</button>
							</div>
							<div class="col-md-4">
								<input type="text" class="form-control" id="img_text" disabled>
							</div>
						</div>
						<div class="row" style="margin-top: 1%;">
							<div class="col-md-4">
								<button type="button" class="btn btn-primary"
									onclick="createNewEnvRecord()" id="new_env_rec_button">Create
									New Record</button>
							</div>
							<div class="col-md-4">
								<button type="button" class="btn btn-primary"
									onclick="updateExistingEnvRecord()" id="update_env_rec_button">Update
									Record</button>
							</div>
							<div class="col-md-4">
								<button type="button" class="btn btn-primary"
									onclick="deleteExistingEnvRecord()" id="delete_env_rec_button">Delete
									Record</button>
							</div>
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
					</div>
				</div>
			</div>
		</div>
		<!-- Modal to CRUD records-->
		<div id="recordsmodal" class="modal fade" role="dialog">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal">&times;</button>
						<h4 class="modal-title">Record</h4>
					</div>
					<div class="modal-body">
						<div class="row" style="margin-top: 1%;">
							<div class="col-md-3">
								<b>DO:</b>
							</div>
							<div class="col-md-3">
								<input type="text" class="form-control" id="do_text">
							</div>
						</div>
						<div class="row" style="margin-top: 1%;">
							<div class="col-md-3">
								<b>Temperature:</b>
							</div>
							<div class="col-md-3">
								<input type="text" class="form-control" id="temp_text">
							</div>
						</div>
						<div class="row" style="margin-top: 1%;">
							<div class="col-md-3">
								<b>cond:</b>
							</div>
							<div class="col-md-3">
								<input type="text" class="form-control" id="cond_text">
							</div>
						</div>
						<div class="row" style="margin-top: 1%;">
							<div class="col-md-3">
								<b>tds:</b>
							</div>
							<div class="col-md-3">
								<input type="text" class="form-control" id="tds_text">
							</div>
						</div>
						<div class="row" style="margin-top: 1%;">
							<div class="col-md-3">
								<b>salinity:</b>
							</div>
							<div class="col-md-3">
								<input type="text" class="form-control" id="salinity_text">
							</div>
						</div>
						<div class="row" style="margin-top: 1%;">
							<div class="col-md-3">
								<b>ph:</b>
							</div>
							<div class="col-md-3">
								<input type="text" class="form-control" id="ph_text">
							</div>
						</div>
						<div class="row" style="margin-top: 1%;">
							<div class="col-md-3">
								<b>coliform:</b>
							</div>
							<div class="col-md-3">
								<input type="text" class="form-control" id="coliform_text">
							</div>
						</div>
						<div class="row" style="margin-top: 1%;">
							<div class="col-md-3">
								<b>cholerae:</b>
							</div>
							<div class="col-md-3">
								<input type="text" class="form-control" id="cholerae_text">
							</div>
						</div>
						<div class="row" style="margin-top: 1%;">
							<div class="col-md-3">
								<b>reschlorine:</b>
							</div>
							<div class="col-md-3">
								<input type="text" class="form-control"
									id="residualchlorine_text">
							</div>
						</div>
						<div class="row" style="margin-top: 1%;">
							<div class="col-md-3">
								<b>date:</b>
							</div>
							<div class="col-md-3">
								<input type="text" class="form-control" id="date_text">
							</div>
						</div>
						<div class="row" style="margin-top: 1%;">
							<div class="col-md-4">
								<button type="button" class="btn btn-primary"
									onclick="createNewRecord()" id="new_rec_button">Create
									New Record</button>
							</div>
							<div class="col-md-4">
								<button type="button" class="btn btn-primary"
									onclick="updateExistingRecord()" id="update_rec_button">Update
									Record</button>
							</div>
							<div class="col-md-4">
								<button type="button" class="btn btn-primary"
									onclick="deleteExistingRecord()" id="delete_rec_button">Delete
									Record</button>
							</div>
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
					</div>
				</div>
			</div>
		</div>
		<div id="vizmodal" class="modal fade" role="dialog">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<div class="tab">
							<button class="tablinks" onclick="openTab(event, 's_point_tab')"
								id="defaultOpen">Sample Point</button>
							<button class="tablinks"
								onclick="openTab(event, 'neighborhood_tab')">Neighborhood</button>
						</div>
					</div>
					<div class="modal-body">
						<div id="s_point_tab" class="tabcontent">
							<div class="row">
								<div class="col-md-3">
									<b>Category:</b>
								</div>
								<div class="col-md-5">
									<select id='vizcategselect' class="form-control"
										onchange="popSamplePointForCategories()">
									</select>
								</div>
							</div>
							<div class="row" style="margin-top: 1%;">
								<div class="col-md-3">
									<b>Point Id:</b>
								</div>
								<div class="col-md-5">
									<select id='vizpointselect' class="form-control"
										onchange="popDateForViz()">
									</select>
								</div>
							</div>
							<div class="row" style="margin-top: 1%;">
								<div class="col-md-3">
									<b>Date:</b>
								</div>
								<div class="col-md-5">
									<select id='vizdateselect' class="form-control">
									</select>
								</div>
							</div>
							<div class="row" style="margin-top: 1%;">
								<div class="col-md-offset-4 col-md-5">
									<button type="button" class="btn btn-primary"
										onclick="startVisualization()">Visualize On
										Samplepoint</button>
								</div>
							</div>
						</div>
						<div id="neighborhood_tab" class="tabcontent">
							<div class="row" style="margin-top: 2%;">
								<div class="col-md-3">
									<b>Neighborhood:</b>
								</div>
								<div class="col-md-5">
									<select id='vizneighborhoodselect' class="form-control"
										onchange="popCategsForNeighborhood()">
									</select>
								</div>
							</div>
							<div class="row" style="margin-top: 1%;">
								<div class="col-md-3">
									<b>Category:</b>
								</div>
								<div class="col-md-5">
									<select id='vizneighborhoodcategselect' class="form-control"
										onchange="popSamplePointForNeighborhoodCategory()">
									</select>
								</div>
							</div>
							<div class="row" style="margin-top: 1%;">
								<div class="col-md-3">
									<b>Point Id:</b>
								</div>
								<div class="col-md-5">
									<select id='vizneighborhoodsamplepointselect'
										class="form-control"
										onchange="popSamplePointDateForNeighborhoodCategory()">
									</select>
								</div>
							</div>
							<div class="row" style="margin-top: 1%;">
								<div class="col-md-3">
									<b>Date:</b>
								</div>
								<div class="col-md-5">
									<select id='vizneighborhoodsamplepointdateselect'
										class="form-control">
									</select>
								</div>
							</div>
							<div class="row" style="margin-top: 1%;">
								<div class="col-md-offset-4 col-md-5">
									<button type="button" class="btn btn-primary"
										onclick="startNeighborhoodVisualization()">Visualize
										On Neighborhood</button>
								</div>
							</div>
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
					</div>
				</div>
			</div>
		</div>
		<div id="datemodal" class="modal fade" role="dialog">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal">&times;</button>
						<h4 class="modal-title">Select Date</h4>
					</div>
					<div class="modal-body">
						<div class="row">
							<div class="col-md-3">
								<b>Sample Point:</b>
							</div>
							<div class="col-md-5">
								<input type="text" id="spoint_id" class="form-control" disabled>
							</div>
						</div>
						<div class="row" style="margin-top: 1%;">
							<div class="col-md-3">
								<b>Date:</b>
							</div>
							<div class="col-md-5">
								<select id='dateselect' class="form-control">
								</select>
							</div>
						</div>
						<div class="row" style="margin-top: 1%;">
							<div class="col-md-3">
								<button type="button" class="btn btn-primary"
									onclick="visualizeSamplePoint()">Visualize</button>
							</div>
							<div class="col-md-4">
								<button type="button" class="btn btn-primary"
									onclick="performWaterPointSpatialQuery()">Spatial
									Query</button>
							</div>
							<div class="col-md-5">
								<button type="button" class="btn btn-primary"
									onclick="downloadStats()">Download Stats</button>
							</div>
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
					</div>
				</div>
			</div>
		</div>
		<div id="record_add_prompt_modal" class="modal fade" role="dialog">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal">&times;</button>
						<h4 class="modal-title">Select Record Type</h4>
					</div>
					<div class="modal-body">
						<div class="row">
							<div class="col-md-4">
								<button type="button" class="btn btn-primary"
									onclick="openExperimentalRecord()">Experimental Record</button>
							</div>
							<div class="col-md-4">
								<button type="button" class="btn btn-primary"
									onclick="openEnvironmentalRecord()">Environmental
									Record</button>
							</div>
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
					</div>
				</div>
			</div>
		</div>
		<div id="record_update_prompt_modal" class="modal fade" role="dialog">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal">&times;</button>
						<h4 class="modal-title">Select Record Type</h4>
					</div>
					<div class="modal-body">
						<div class="row">
							<div class="col-md-5">
								<div class="col-md-5">
									<b>Date:</b>
								</div>
								<div class="col-md-7">
									<select id='dateselectexpupdate' class="form-control">
									</select>
								</div>
							</div>
							<div class="col-md-5">
								<div class="col-md-5">
									<b>Date:</b>
								</div>
								<div class="col-md-7">
									<select id='dateselectenvupdate' class="form-control">
									</select>
								</div>
							</div>
						</div>
						<div class="row" style="margin-top: 1%;">
							<div class="col-md-5 col-md-offset-1">
								<button type="button" class="btn btn-primary"
									onclick="updateExperimentalRecord()">Experimental
									Record</button>
							</div>
							<div class="col-md-5">
								<button type="button" class="btn btn-primary"
									onclick="updateEnvironmentalRecord()">Environmental
									Record</button>
							</div>
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
					</div>
				</div>
			</div>
		</div>
		<!-- Download modal -->
		<div id="download_modal" class="modal fade" role="dialog">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal">&times;</button>
						<h4 class="modal-title">Download</h4>
					</div>
					<div class="modal-body">
						<div class="row">
							<div class="col-md-4">
								<button type="button" class="btn btn-primary"
									onclick="selectOutputFolder()">Output Folder</button>
							</div>
							<div class="col-md-6">
								<input type="text" class="form-control" id="out_folder">
							</div>
						</div>
						<div class="row" style="margin-top: 1%;">
							<div class="col-md-4">
								<b>Date:</b>
							</div>
							<div class="col-md-6">
								<input type="text" class="form-control" id="download_date">
							</div>
						</div>
						<div class="row" style="margin-top: 1%;">
							<div class="col-md-6">
								<button type="button" class="btn btn-primary"
									onclick="downloadShape()">Shape File</button>
							</div>
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
					</div>
				</div>
			</div>
		</div>
		<!-- Edit Modal-->
		<div id="edit_modal" class="modal fade" role="dialog">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal">&times;</button>
						<h4 class="modal-title">Edit</h4>
					</div>
					<div class="modal-body">
						<div class="row" style="margin-top: 1%;">
							<div class="col-md-5">
								<button type="button" class="btn btn-primary"
									onclick="createSamplePoint()">Create Sample Point</button>
							</div>
							<div class="col-md-5">
								<button type="button" class="btn btn-primary"
									onclick="updateSamplePoint()">Update Sample Point</button>
							</div>
							<div class="col-md-2">
								<select class="form-control" id="samplepoints"
									onchange="highlightLocation()">
								</select>
							</div>
						</div>
						<!-- Create new records-->
						<div class="row" style="margin-top: 1%;">
							<div class="col-md-2">
								<b>Point Id:</b>
							</div>
							<div class="col-md-4">
								<select class="form-control" id="add_spoints">
								</select>
							</div>
							<div class="col-md-4">
								<button type="button" class="btn btn-primary"
									onclick="addRecord()">Add Record</button>
							</div>
						</div>
						<!-- Update new records-->
						<div class="row" style="margin-top: 1%;">
							<div class="col-md-2">
								<b>Point Id:</b>
							</div>
							<div class="col-md-4">
								<select class="form-control" id="update_spoints">
								</select>
							</div>
							<div class="col-md-3">
								<button type="button" class="btn btn-primary"
									onclick="updateRecord()">Update Record</button>
							</div>
						</div>
						<!-- Upload new records-->
						<div class="row" style="margin-top: 1%;">
							<div class="col-md-6">
								<button type="button" class="btn btn-primary"
									onclick="uploadExperimentalRecords()">Upload
									Experimental Records</button>
							</div>
							<div class="col-md-6">
								<button type="button" class="btn btn-primary"
									onclick="uploadEnvironmentalRecords()">Upload
									Environmental Records</button>
							</div>
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
					</div>
				</div>
			</div>
		</div>
		<!-- Stats Modal-->
		<div id="stats_modal" class="modal" role="dialog">
			<div class="modal-dialog modal-lg" id='stat_dialog'>
				<div class="modal-content" id='stat_content'>
					<div class="modal-header" id='stat_header'>
						<button type="button" class="close" data-dismiss="modal">&times;</button>
						<h4 class="modal-title">Stats</h4>
					</div>
					<div class="modal-body" id='stat_body'>
						<div class="row" style="margin-top: 1%; min-height: 80%;">
							<div id="wrapper">
								<table class="table table-striped" id="statstable">
									<thead>
										<tr>
											<th width="10%">Name</th>
											<th width="15%">Neighborhood</th>
											<th width="15%">Category</th>
											<th width="15%">Change%</th>
											<th width="10%">Neighb_rank</th>
											<th width="10%">Categ_rank</th>
											<th width="15%">Coliform(log)</th>
											<th width="10%">Self_rank</th>
										</tr>
									</thead>
									<tbody>
									</tbody>
								</table>
							</div>
						</div>
						<!-- Time Slider-->
						<div class="row" style="margin-top: 1%; min-height: 15%;">
							<div class="col-md-7">
								<input type="range" min="1" max="100" value="50" id="timeslider"
									onchange="timeslidechange()">
							</div>
							<div class="col-md-5">
								<input type="text" id="yearmonth">
							</div>
						</div>
					</div>
					<div class="modal-footer" id='stat_footer'>
						<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
					</div>
				</div>
			</div>
		</div>
		<!-- heatmap Modal-->
		<div id="heatmap_modal" class="modal" role="dialog">
			<div class="modal-dialog modal-md">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal">&times;</button>
						<h4 class="modal-title">Heatmap</h4>
					</div>
					<div class="modal-body">
						<div class="row">
							<div class="col-md-6">
								<div class="col-md-8">
									<input type="range" min="1" max="100" value="50"
										id="hmaptimeslider" onchange="hmaptimeslidechange()">
								</div>
								<div class="col-md-4">
									<input type="text" id="hmapyearmonth" style="width:95%;">
								</div>
							</div>
							<div class="col-md-3">
								<select id="hmapcategories" onchange="hmaptimeslidechange()"></select>
							</div>
							<div class="col-md-3">
								<select id="hmapneighborhoods" onchange="hmaptimeslidechange()"></select>
							</div>
						</div>
						<div class="row">
							<div class="col-md-3">
								<button type="button" class="btn btn-primary" onclick="toggleWaterPoints('show')">Show Marker</button>
							</div>
							<div class="col-md-3">
								<button type="button" class="btn btn-primary" onclick="toggleWaterPoints('hide')">Hide Marker</button>
							</div>
							<div class="col-md-6">
								<button type="button" class="btn btn-primary" onclick="removeHeatMap()">Remove Heatmap</button>
							</div>
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
					</div>
				</div>
			</div>
		</div>
	</div>
</body>
</html>
